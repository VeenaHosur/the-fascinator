ARROW Portal
============

The ARROW portal software consists of harvesting and indexing software and a
web portal front-end for searching institutional repositories. It is built on
Apache Solr and Fedora Commons software.


Requirements
============

  * Java 5 (or greater)
  * Fedora 3.0 (with REST API enabled)
  * Apache Tomcat 5 (recommend using Tomcat bundled with Fedora)
  * Solr 1.2

The instructions assume Tomcat, Fedora and Solr have been installed in the
following directories:

  Tomcat: /opt/fedora/tomcat
  Fedora: /opt/fedora
  Solr:   /opt/solr


Installation
============

The following instructions assume the user has proper read/write permissions
to the /opt directory.

Binary distribution
-------------------

1. Download and extract the ZIP file.

   curl -O https://rubric-central.usq.edu.au/solrsvn/public/dist/arrow-portal-dist.zip
   mkdir arrow-portal
   cd arrow-portal
   unzip ../arrow-portal-dist.zip

Solr configuration
------------------

1. Install the Solr schema and Fedora update handler.

   Solr schema:
     cp harvest-moon/solr/schema.xml /opt/solr/conf

   Solr Fedora update handler:
     cp harvest-moon/solr/harvest-moon-solr.jar /opt/fedora/tomcat/solr/WEB-INF/lib

2. Add the following configuration to /opt/solr/conf/solrconfig.xml using values
   specific to your environment.

   <!-- Fedora update handler -->
   <requestHandler name="/fedora" class="au.edu.usq.solr.handler.FedoraUpdateRequestHandler">
     <str name="fedoraUrl">http://localhost:8080/fedora</str>
     <str name="fedoraUser">fedoraAdmin</str>
     <str name="fedoraPass">fedoraAdmin</str>
   </requestHandler>

Fedora configuration
--------------------

1. Install the SolrDOManager.

   cp fedora-services/fedora-services.jar /opt/fedora/tomcat/fedora/WEB-INF/lib

2. Edit the Fedora server configuration to use the SolrDOManager.

   Change the DOManager class to "au.edu.usq.solr.fedora.SolrDOManager":
     <module role="fedora.server.storage.DOManager" class="au.edu.usq.solr.fedora.SolrDOManager">

   Configure the namespaces to accept "uuid" and "sof":
     <param name="pidNamespace" value="uuid">
     <param name="retainPIDs" value="uuid sof">

   Add Solr parameters:
     <param name="solrUrl" value="http://localhost:8080/solr" />
     <param name="syncUpdate" value="true" />

Portal configuration
--------------------

1. Copy the default portal configuration files to a directory such as
   /opt/sun-of-fedora. This is where the portal templates and configuration
   files are saved.

   mkdir /opt/sun-of-fedora
   cd sun-of-fedora
   cp -r config/ /opt/sun-of-fedora/

2. Create configuration files from the samples provided. If you used the
   /opt directories as suggested, the only configuration required is the LDAP
   in config.properties.

   cd sun-of-fedora/WEB-INF
   cp config.properties.sample config.properties
   cp velocity.properties.sample velocity.properties
   cd ..

3. Update the web package with your configuration files.

   zip -u sun-of-fedora.war WEB-INF/*

4. Install the portal application in Tomcat.

   cp sun-of-fedora.war /opt/fedora/tomcat/webapps

5. Startup Tomcat and open a browser to http://localhost:8080/sun-of-fedora
   (by default) to test if the application was deployed correctly.

   cd /opt/fedora/tomcat/bin
   ./startup.sh


Harvesting
==========

Create a harvest properties file and indexing rules. See the harvest-moon/config
directory for examples. Then run the harvest.sh script with your properties file.
For example:

   ./harvest.sh config/rubric.properties


Building from source
====================

This is useful for developers wanting to modify the code. Skip this section if
you only need to deploy the software. Make sure to have Maven 2 installed
before proceeding.

1. Check out the source code.

   svn co https://rubric-central.usq.edu.au/solrsvn/public/arrow-portal /opt/arrow-portal
   cd /opt/arrow-portal

2. Build the project. This will create the binary distribution ZIP file
   /opt/arrow-portal/target/arrow-portal-dist.zip

   cd /opt/arrow-portal
   mvn clean package install assembly:assembly

3. You can now follow the binary distribution install using the generated ZIP.


Portal customisation
====================
Each portal can be given a distinct look and feel by using Velocity templates
and stylesheets (CSS). The templates are located in the portal configuration
directory ('/opt/sun-of-fedora' by default). The default look and feel is
located in the 'default' directory and provides an example of how the templates
are written.

When a portal is created in the webapp, a new directory is created with the
portal.xml configuration file. Templates can be copied from the 'default'
directory and customised as required.
