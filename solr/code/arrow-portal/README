Sun of Fedora
=============

This application is a web portal front-end for searching institutional
repositories. It is built on Apache Solr and Fedora Commons software.

Requirements
============

  * Java 5 (or greater)
  * Apache Tomcat 5 (or greater)
  * Fedora 3.0 (with REST API enabled)
  * Solr 1.2
  * Maven 2

The instructions assume Tomcat, Fedora and Solr have been installed in the
following directories:

  Tomcat: /opt/fedora/tomcat
  Fedora: /opt/fedora
  Solr:   /opt/solr

Building the software
=====================

1. Check out the source code.

   svn co https://rubric-central.usq.edu.au/solrsvn/public/arrow-portal /opt/arrow-portal

2. Make a copy of the portal configuration directory, such as /opt/sun-of-fedora.

   cp -r /opt/arrow-portal/sun-of-fedora/src/main/config/portal /opt/sun-of-fedora

3. Copy the sample configuration files and edit them to configure the portal
   directories and LDAP settings.

   cd /opt/arrow-portal/sun-of-fedora/src/main/webapp/WEB-INF
   cp config.properties.sample config.properties
   cp velocity.properties.sample velocity.properties

   config.properties:
     portals.dir = /opt/sun-of-fedora

   velocity.properties:
     file.resource.loader.path = /opt/sun-of-fedora

4. Build the project using Maven. This will create the necessary files for
   deployment.

   cd /opt/arrow-portal
   mvn package install

Solr configuration
------------------

1. Copy the schema into Solr's conf directory.

   cp /opt/arrow-portal/harvest-moon/src/main/resources/solr/schema.xml /opt/solr/conf

2. Copy the harvest library so that Solr can use the Fedora update handler.

   cp /opt/arrow-portal/harvest-moon/target/harvest-moon-solr.jar /opt/fedora/tomcat/webapps/solr/WEB-INF/lib

3. Add the following configuration to /opt/solr/conf/solrconfig.xml using values
   specific to your environment.

   <!-- Fedora update handler -->
   <requestHandler name="/fedora" class="au.edu.usq.solr.handler.FedoraUpdateRequestHandler">
     <str name="fedoraUrl">http://localhost:8080/fedora</str>
     <str name="fedoraUser">fedoraAdmin</str>
     <str name="fedoraPass">fedoraAdmin</str>
   </requestHandler>

Fedora configuration
--------------------

1. Copy the Fedora services library so that Fedora can use the SolrDOManager.

   cp /opt/arrow-portal/fedora-services/target/fedora-services.jar /opt/fedora/tomcat/webapps/fedora/WEB-INF/lib

2. Edit the Fedora server configuration to use the SolrDOManager.

   Change the DOManager class to "au.edu.usq.solr.fedora.SolrDOManager"
     <module role="fedora.server.storage.DOManager" class="au.edu.usq.solr.fedora.SolrDOManager">

   Configure the namespaces to accept "uuid" and "sof"
     <param name="pidNamespace" value="uuid">
     <param name="retainPIDs" value="uuid sof">

   Add the solrUrl parameter:
     <param name="solrUrl" value="http://localhost:8080/solr"/>

Portal Installation
-------------------

1. Copy the web package to your Tomcat's webapps directory.

   cp /opt/arrow-portal/sun-of-fedora/target/sun-of-fedora.war /opt/tomcat/webapps

1. Startup Tomcat and open a browser to http://localhost:8080/sun-of-fedora
   (by default) to test if the application was deployed correctly.

   cd /opt/fedora/tomcat/bin
   ./startup.sh


Portal customisation
====================
Each portal can be given a distinct look and feel by using Velocity templates
and stylesheets (CSS). The templates are located in the portal configuration
directory (see Step 2 of Installation section). The default look and feel is
located in the 'default' directory and provides an example of how the templates
are written.

When a portal is created in the webapp, a new directory is created with the
portal.xml configuration file. Templates can be copied from the 'default'
directory and customised as required.
