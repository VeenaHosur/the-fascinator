<script type="text/javascript" src="$portalPath/js/tree/jquery.tree.min.js"></script>
<script type="text/javascript" src="$portalPath/js/jquery.truncate.js"></script>
<script type="text/javascript" src="$portalPath/js/anotar/json2.js"></script>
<script type="text/javascript" src="$portalPath/js/anotar/anotar-0.2.js"></script>

<script type="text/javascript">
$(function(){
    jQ = jQuery;
    // Tags annotation
    tagConfig = {
        //debug: true,
        docRoot: "#result-list",
        tagList: ".tags",
        contentInput: "#object-tag-input",
        uriAttr: "rel",
        outputInChild: ".tags-here",
        annotationType: "tag",
        stylePrefix: "tags-",
        displayCustom: "tag_display",
        creator: "$creator",
        creatorUri: "$creatorUri",
        interfaceLabel: " <img src='$portalPath/images/icons/add.png'/>",
        interfaceVisible: true,
        formCustom: "object_tag_form",
        formCancel: ".myTag-cancel",
        formSubmit: ".myTag-submit",
        serverAddress: "$portalPath/actions/anotar.ajax",
        disableReply: true,
        serverMode: "fascinator",
        loadAnnotations: function() {
            var config = this;
            var rootUriList = [];
            jQ.each(jQ(config.tagList), function(count, item) {
                rootUriList.push(jQ(item).attr("rel"));
            });
            jQ.post("$portalPath/actions/anotar.ajax",
                { "action": "getList",
                  "rootUriList": rootUriList,
                  "type": config.annoType
                },
                function(data, status) {
                    try{
                        jQ.each(data, function(count, item) {
                            config.loadAnnotation(item);
                        });
                    } catch(e) {
                    }
                },
                "json");
        }
    }
    tag = anotarFactory(jQ, tagConfig);
});
</script>

<script type="text/html" id="tag_display">
    <% if (contentUri != null) { %>
        <% if (contentUri.indexOf("http://www.geonames.org") == 0 || contentUri.indexOf("http://www.geohash.org") == 0) { %>
            <span class='<%=style%>tag'>
                <a href="<%=contentUri%>" target="_blank"><%=content%><% if(tagCount > 1){ %> (<%=tagCount%>)<% } %></a>
            </span>
        <% }%>
    <% } else { %>
        <span class='<%=style%>tag'><%=content%></span>
      ##<a href="http://www.geonames.org/search.html?q=<%=content%>"><%=content%></a>
    <% }%>
</script>

<script type="text/html" id="object_tag_form">
  <div class='myTags float-right'>Tag this:
    <input id="object-tag-input" type="text" />
    <img src='$portalPath/images/icons/tick.png' class='myTag-submit' />&#160;
    <img src='$portalPath/images/icons/cross.png' class='myTag-cancel' />
  </div>
</script>
