#macro(createFacetMenu $facetFieldKey)
  #set($facetCounts = $self.getFacetCounts($facetFieldKey))
  #if($facetCounts.size() > 0)
  <div class="facet-group mainmenu ui-helper-clearfix">
    <div class="mainmenu-top"></div>
    <div class="mainmenu-heading"><span class="ui-icon ui-icon-triangle-1-e icon"></span>$self.getFacetName($facetFieldKey)</div>
    <ul class="facet-list ui-helper-hidden" id="$facetFieldKey">
    #foreach($facetCountKey in $facetCounts.keySet())
      #set($facetCount = $facetCounts.get($facetCountKey))
      #set($facetQuery = $self.getFacetQuery($facetFieldKey, $facetCountKey))
      <li>
        #set($key = $page.escapeText($self.getFacetValue($facetCountKey)))
        <a style="padding-left:$self.getFacetIndent($facetCountKey)px" href="$portalPath/browse?fq=$page.urlencode($facetQuery)">$key</a> ($facetCount)
      </li>
    #end
    </ul>
  </div>
  <span><!-- empty span to prevent IE from collapsing whitespace --></span>
  #end
#end
#set($pageTitle = 'Home')
<table class="layout">
  <tbody>
    <tr>
      <td class="leftcol">
        <div class="columnbox">
          <div class="mainmenu">
            <div class="mainmenu-top"></div>
            <div class="mainmenu-heading">USQ Policy Library</div>
            <ul class="menu-list">
              <li class="selected">Home</li>
              <li><a href="$portalPath/browse">Browse</a></li>
              <li><a href="$portalPath/help">Help</a></li>
            </ul>
          </div>
          #createFacetMenu("f_usq_document_policy_type")
          #createFacetMenu("f_title_group")
        </div>
      </td>
      <td class="middlecol">
        <div class="home">
          <div class="home-welcome">
            <h2 class="content-title">University Policy Library</h2>
            <p>The University Policy Library is the definitive source of current policy and procedural documentation relating to the governance and management of the academic affairs of the University.</p>
          </div>
          <div class="home-search">
            <h2>Search</h2>
            <p><em>Insert custom search code here</em></p>
          </div>
        </div>
      </td>
    </tr>
  </tbody>
</table>
<script type="text/javascript">
$(function() {
    var cookieOpts = { path: "/", expires: 10 };
    createTree("#policy_type", "f_usq_document_policy_type", "", "");
    
    //autocomplete
    $("input#query").autocomplete("$portalPath/autocomplete.ajax");
    
    // toggle facets
    $(".mainmenu:has(.facet-list) > .mainmenu-heading")
        .each(function() {
            var next = $(this).next();
            var icon = $(this).find("span");
            var id = next.attr("id");
            var state = jQuery.cookie("tf_" + id);
            if (state == "true") {
                icon.removeClass("ui-icon-triangle-1-e");
                icon.addClass("ui-icon-triangle-1-s");
                next.show();
            } else {
                icon.addClass("ui-icon-triangle-1-e");
                icon.removeClass("ui-icon-triangle-1-s");
                next.hide();
            }
        })
        .click(function() {
            var next = $(this).next();
            var icon = $(this).find("span");
            var id = next.attr("id");
            icon.toggleClass("ui-icon-triangle-1-e");
            icon.toggleClass("ui-icon-triangle-1-s");
            next.toggle();
            var state = next.is(":visible");
            jQuery.cookie("tf_" + id, state, cookieOpts);
            return false;
        });
});
</script>
