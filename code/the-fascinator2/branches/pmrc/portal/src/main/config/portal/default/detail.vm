<script type="text/javascript" src="$portalPath/js/tree/jquery.tree.min.js"></script>
#set($pageTitle = 'Detail')
#if($self.solrResponse.get("response/numFound") == 0)
<h2 id="page-heading">Page not found</h2>
<p>Please try a different <a href="$portalPath/search">search</a>.</p>
#else
#set($meta = $self.metadata)
#set($oid = $self.object.id)
#set($filenameNoExt = $self.getFilePathWithoutExt($oid))
#set($hasPreview = $self.getPreview($oid))
#set($title = $meta.getField("dc_title"))
#set($description = $meta.getField("dc_description"))
#set($error = $self.getErrorPayload())
#if($title == "")
  #set($title = $self.getFileName($oid))
#end
##<h2 id="page-heading">$title</h2>

<table class="layout" width="10px">
  <tbody>
    <tr>
      <td class="leftcol">
        <div class="columnbox">
          <div class="mainmenu">
            <div class="mainmenu-top"></div>
            <div class="mainmenu-heading">Public Memory Research Centre</div>
            <ul class="menu-list">
              <li><a href="$portalPath/home">Home</a></li>
              <li><a href="$portalPath/search">Search</a></li>
              <li><a href="$portalPath/help">Help</a></li>
            </ul>
          </div>
          <div class="mainmenu">
            <div class="mainmenu-top"></div>
            <div class="mainmenu-heading">Actions</div>
            <ul class="menu-list">
                #if(!$self.isMetadataOnly())
                  <li><a id="open-this" href="$portalPath/detail/$oid">Open file</a></li>
                #end
                <li><a id="reharvest" href="$portalPath/detail/$oid">Re-Harvest...</a></li>
            </ul>
          </div>
          <div class="mainmenu">
            <div class="mainmenu-top"></div>
            <div class="mainmenu-heading">Downloads</div>
            <ul class="menu-list">
              <li><a href="$portalPath/download/$self.getPayLoadUrl($self.getFileName($oid))">$self.getFileName($oid)</a> <span style="font-weight:normal">($self.getFileSize($oid))</span></li>
            </ul>
          </div>
          <!--<div class="mainmenu">
            <div class="mainmenu-top"></div>
            <div class="mainmenu-heading">Metadata</div>
            #set($pageHeader="#parse($page.getTemplate('detail-dc-meta.vm'))")
            <div class="block">
              <dl class="meta">
              #foreach($key in $dc.keySet())
                <dt>$self.formatName($key)</dt>
                #set($valueList = $dc.get($key))
                <dd>
                  <ul>
                  #foreach($value in $valueList)
                    <li>$value</li>
                  #end
                  </ul>
                </dd>
              #end
              </dl>
            </div>
          </div>
          <div class="mainmenu">
            <div class="mainmenu-top"></div>
            <div class="mainmenu-heading">Attachments</div>
            <ul class="menu hidden">
            #foreach($payload in $self.object.payloadList)
              #set($pid = $payload.id)
              #set($payloadType = $payload.type.toString())
              <li class="payload" rel="$payload.contentType">
                <a href='$portalPath/download/$self.encode($oid)/$self.encode($pid)' rel="$payloadType" target="blank" title="$payload.contentType">$payload.id</a>
              </li>
            #end
            </ul>
          </div>
          -->
        </div>
      </td>
      <td class="middlecol">
        <div class="detail">
        #if($self.solrResponse.get("response/numFound") == 0)
          #set($pageTitle = "Not found")
          #set($breadcrumb = "Not found")
          <h1 class="content-title">Page not found</h1>
          <h2>There is no media matching your request.</h2>
          <p>You have been redirected to this page because one of the following occurred:</p>
          <ul type="disc">
            <li>It is possible the URL was misspelled or typed incorrectly.</li>
            <li>You have requested an item that no longer exists.</li>
          </ul>
          <p>Return to the <a href="$portalPath/home">Public Memory Research Centre</a>.</p>
        #else
          #set($oid = $self.object.id)
          #set($title = $self.metadata.getField("dc_title"))
          #set($pageTitle = $title)
          #set($breadcrumb = '<a href="' + $portalPath  + '/search">Search</a> &gt; ' + $title)
          <h1 class="content-title">$title</h1>
          <div id="preview" class="box articles">
            <h2>Preview</h2>
            <div id="object-tag-list">
              <p rel="$page.md5Hash($oid)_object">Tags: <span class="object-tags"></span></p>
            </div>
            <div id="location-tag-list">
              <p rel="$page.md5Hash($oid)_location">Location: <span class="location-tags"></span></p>
            </div>
            <div id="anno-root" class="content-preview">
              <span class="mimetype" rel="$self.mimeType"></span>
              <div class="first article clearfix">
            #if($self.mimeType.startsWith("audio/") || $self.mimeType.startsWith("video/"))
                <!-- <input class='player_clear_fragment' type='button' value='Reset' /> -->
                <table>
                  <tbody>
                    <tr>
                      <td id="player-container"></td>
                      <td>
                        <div class="video-results-list">
                          <div class="video-result-list" anotar-uri="$portalPath/$self.object.id">
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
            #else
                <h3 class="title-heading">$title</h3>
                <div class="content-preview-inline" width="100px">$!self.payloadContent</div>
                <div class="annotatable">Comment on this document:</div>
                <script type="text/javascript" src="$portalPath/js/viewer.js"></script>
              </div>
            #end
            </div>
          </div>
          
        #end
        </div>
      </td>
    </tr>
  </tbody>
</table>
<div class="clear"><!--clear--></div>
#if($self.mimeType.startsWith("audio/") || $self.mimeType.startsWith("video/"))
<script type="text/javascript" src="$portalPath/flowplayer/flowplayer-3.1.4.min.js"></script>
<script type="text/javascript" src="$portalPath/flowplayer/flowplayer.controls-3.0.2.js"></script>
<script type="text/javascript" src="$portalPath/js/anotar/video.annotate.js"></script>
#end
#if($self.mimeType.startsWith("image/"))
<script type="text/javascript" src="$portalPath/js/anotar/image.annotate.js"></script>
<script language="javascript">
    $(window).load(function() {
        $("#toAnnotate").annotateImage({
            editable: true,
            saveUrl: "$portalPath/actions/anotar.ajax?action=save-image&rootUri=$oid",
            getUrl: "$portalPath/actions/anotar.ajax?action=get-image&rootUri=$oid"
        });
    });
</script>
#end
<script type="text/javascript" src="$portalPath/js/tree/jquery.tree.min.js"></script>
<script type="text/javascript" src="$portalPath/js/autocomplete/lib/jquery.ajaxQueue.js"></script>
<script type="text/javascript" src="$portalPath/js/autocomplete/lib/jquery.bgiframe.js"></script>
<script type="text/javascript" src="$portalPath/js/autocomplete/jquery.autocomplete.pack.js"></script>
<!--<script type="text/javascript" src="$portalPath/js/autocomplete/jquery.autocomplete.js"></script>-->
<script type="text/javascript">
var display_help = false;
function toggleHelp(help_link) {
    if (!display_help) {
        $(".help_p").css("display", "block");
        help_link.text("Hide help");
        display_help = true;
    } else {
        $(".help_p").css("display", "none");
        help_link.html("Show help");
        display_help = false;
    }
}

$(function() {
    var oid = "$oid";
    var filenameNoExt = "$filenameNoExt";
    function fixLinks(baseUrl, selector, attrName) {
        $(selector).each(function() {
            var attr = $(this).attr(attrName);
            if (attr != null) {
                if (attr.indexOf("#") != 0 && attr.indexOf("://") == -1) {
                    var relUrl = "$portalPath/download/$self.object.id/";
                    var tmpUrl = baseUrl.substring(baseUrl.indexOf("/", 8));
                    tmpUrl = tmpUrl.replace(relUrl, "");
                    tmpUrl = tmpUrl.substring(0, tmpUrl.lastIndexOf("/")+1);
                    $(this).attr(attrName, escape(relUrl + tmpUrl + attr));
                }
            }
        });
    }
    gFixLinks = fixLinks;
    fixLinks("", "div.content-preview-inline a", "href");
    fixLinks("", "div.content-preview-inline img", "src");

    $("#open-this").click(function() {
        jQuery.post("$portalPath/open.ajax", { func: "open-file", file: "$oid" } );
        return false;
    });

    $("#reharvest").click(function() {
        jQuery.post("$portalPath/reharvest.ajax", { func: "reharvest", file: "$oid" } );
        return false;
    });

    function addRendition(href, label) {
        $("#actions").append('<li><a href="' + href + '" target="blank">' + label + '</a></li>');
    }
    $('li.payload[rel="application/pdf"] a:first').each(function() {
        addRendition($(this).attr("href"), "PDF version");
    });
    $("span.slide-link > a").each(function() {
        addRendition($(this).attr("href"), "View slide show");
    });
    $("div.rendition-links").remove();

    var player;
    var mimeType = "$self.mimeType";
    //<a class="image" href="' + src + '" ">
    if (mimeType.indexOf("image/") == 0) {
        var src = "$hasPreview";
        if (src == "")
            src = "$portalPath/download/$oid";
        else
            src = "$portalPath/download/$self.encode($oid)/" + src
        $("div.content-preview div.article").html(
            '<div id="$oid" class="annotatable"><div class="image">' +
                '<img class="image" id="toAnnotate" src="' + src + '" style="max-width: 900px;" />' +
            '</div><div class="clear"></div></div>');
    } else if (mimeType.indexOf("audio/") == 0 || mimeType.indexOf("video/") == 0) {
        var height = 300;
        if (mimeType.indexOf("audio/") == 0) {
            height = 24;
        }

        var style = "display: block; width: 425px; height: " + height + "px";
        //var style = "display: block; width: 500px; height: 300px";
        var filename = oid.substring(oid.lastIndexOf("/") + 1);
        var ext = filename.substring(filename.lastIndexOf(".") + 1).toLowerCase();

        var hasFlv = "$self.hasFlv()";
        if (hasFlv!='') {
            filename = hasFlv;
        }
        
        if (hasFlv!='' || ext=="mp3" || ext=="m4a") {
            var href = "$portalPath/download/$oid/" + filename;
            var player1 = '<div href="' + href + '" id="player" style="' + style + '"></div>'; 
            $("#player-container").attr("style", style).html(player1);
            player = flowplayer("player", "$portalPath/flowplayer/flowplayer-3.1.5.swf",
                { clip: { autoPlay: false, autoBuffering: true },
                  play: {
                    label: "Play",
                    replayLabel: "Click to play again"
                    }
                  //plugins: {controls: null} 
                }); //.controls("hulu", {duration: 25});
        } else {
            var error = "$self.hasError()";
            if (hasFlv=="false") {
                $("div.content-preview div.article").empty().append("No preview available");
            }
        }
    }

    $("#player_seek_start").live("click", function() {
        player.seek(0);
    });
    $("#player_rewind").live("click", function() {
        player.seek(player.getTime() - 1);
    });
    $("#player_play").live("click", function() {
        player.toggle();
    });
    $("#player_forward").live("click", function() {
        player.seek(player.getTime()+1);
    });
    $("#player_seek_end").live("click", function() {
        player.seek(player.getClip().fullDuration-1);
        player.pause();
    });
    
    $("#player_mark_start_time").live("click", function() {
        $("#txtStartMark").attr("value", player.getTime());
        $("#player_mark_end_time").attr("disabled", false);
        $("#txtEndMark").attr("disabled", false);
    });
    $("#player_mark_end_time").live("click", function() {
        $("#txtEndMark").attr("value", player.getTime());
        uri = player.getClip().url + "#";
        start = $('#txtStartMark').val();
        end = $('#txtEndMark').val()
        if (start != "" && end != "") {
            //Use Normal Play Time as described in http://www.ietf.org/rfc/rfc2326.txt
            uri += "t=npt:";
            if (start != "" && start > 0) {
                uri += start + "s"
                if (player.getClip().duration < start) {
                    //warning += "<li>The requested start-point is greater than the video's duration.</li>";
                }
            }
            if (end != "") {
                uri += "," + end + "s";
                if (player.getClip().duration < end) {
                    //warning += "<li>The requested end-point is greater than the video's duration.</li>";
                }
            }
        }
        $(".video-result-list").attr("rel", uri);
    });
    
    $(".player_clear_fragment").live("click", function() {
        $("#txtStartMark").attr("value", "");
        $("#txtEndMark").attr("value", "");
        $("#media_clip").attr("rel", "");
        if (player.getClip()) {
            player.pause();
            player.getClip().update({duration:player.getClip().fullDuration});
        }
    });
    
    $("#player_play_fragment").live("click", function() {
        player.pause();
        player.seek($('#txtStartMark').val());
        player.getClip().update({duration:$('#txtEndMark').val()});
        player.play();
    });
    
    $(".player_play_clip").live("click", function() {
        player.pause();
        var startTime = $(this).siblings(".startTime").text().replace("s", "");
        var endTime = $(this).siblings(".endTime").text().replace("s", "");
        player.seek(startTime);
        player.getClip().update({duration:endTime});
        player.play();
    });
});
</script>
<script type="text/javascript" src="$portalPath/js/anotar/json2.js"></script>
<!--<script type="text/javascript" src="$portalPath/js/anotar/anotar-0.1.js"></script>-->
<script type="text/javascript" src="$portalPath/js/anotar/anotar-0.2.js"></script>

<script type="text/html" id="object_tag_form">
    <div class='myTags float-right'>Tag this:
      <input id="object-tag-input" type="text" />
      <img src='$portalPath/images/icons/tick.png' class='myTag-submit' />&#160;
      <img src='$portalPath/images/icons/cross.png' class='myTag-cancel' />
    </div>
</script>

<script type="text/javascript">
    $(function(){
        var jQ = jQuery;
        
        // Tags annotation
        tagConfig = {
            //debug: true,
            docRoot: "#object-tag-list",
            tagList: "p",
            contentInput: "#object-tag-input",
            pageUri: "$self.object.id",
            uriAttr: "rel",
            outputInChild: ".object-tags",
            annotationType: "tag",
            stylePrefix: "tags-",
            interfaceLabel: " <img src='$portalPath/images/icons/add.png'/>",
            formPrepend: true,
            interfaceVisible: true,
            formCustom: "object_tag_form",
            formCancel: ".myTag-cancel",
            formSubmit: ".myTag-submit",
            serverAddress: "$portalPath/actions/anotar.ajax",
            getAnnotation: null,
            disableReply: true,
            serverMode: "fascinator"
        }
        tag = anotarFactory(jQ, tagConfig);
        
        
        // Location Tags annotation
        locationConfig={
            debug: true,
            docRoot: "#location-tag-list",
            tagList: "p",
            contentInput: "#txtName",
            pageUri: "$self.object.id",
            uriAttr: "rel",
            outputInChild: ".location-tags",
            annotationType: "tag",
            stylePrefix: "tags-",
            interfaceLabel: " <img src='$portalPath/images/icons/add.png'/>",
            //formPrepend: true,
            interfaceVisible: true,
            formCustom: "location_form",
            formCancel: ".locTag-cancel",
            formSubmit: ".locTag-submit",
            displayCustom: "location_tag_form", 
            onFormDisplay: function(node){
            	console.log("node: ", node);
				$(node).autocomplete('$portalPath/actions/geonames.ajax', {
					extraParams: {"func":"placeName"}, 
					formatItem: function(row) {
						return row[0];
					}
				}).result(function(event, item) {
					if (item) {
						$("#location-tag-list").attr("rel", item[1]);
					}
				});
            },
            getContentUri: function(node) {
                var rel = node.attr("rel");
                if (rel == null) {
                    // content is not a URI
                    return { isUri: false };
                }
                return { isUri: true, contentUri: "http://www.geonames.org/" + rel };
            },
            serverAddress: "$portalPath/actions/anotar.ajax",
            disableReply: true,
            serverMode: "fascinator"
        }
        /// Use formCloseFunction to overwrite close function
        locationTag = anotarFactory(jQ, locationConfig);
        
        /*
        // Tags annotation
        var tags = new Anotar();
        tags.setType("Tag");
        //tags.setConfig("debug", true);
        tags.setConfig("doc_root", "#object-tag-list");
        tags.setConfig("tag_list", "p");
        tags.setConfig("page_uri", "$self.object.id");
        tags.setConfig("uri_attr", "id");
        tags.setConfig("anno_type", "http://www.purl.org/anotar/ns/type/0.1#Tag");
        tags.setConfig("style_prefix", "tags-");
        tags.setConfig("proxy_required", false);
        tags.setConfig("interface_label", " <img src='$portalPath/images/icons/add.png'/>");
        tags.setConfig("interface_visible", true);
        tags.setConfig("form_prepend", true);
        tags.setConfig("form_custom", "<div class='myTags float-right'>Tag this:" +
          "<textarea></textarea>" +
          "<img src='$portalPath/images/icons/tick.png' class='myTag-submit'/>&#160;" +
          "<img src='$portalPath/images/icons/cross.png' class='myTag-cancel'/>" +
        "</div>");
        //tags.setConfig("hash_function", function(me) { return me.attr("anotar-hash"); });
        tags.setConfig("form_cancel", ".myTag-cancel");
        tags.setConfig("form_submit", ".myTag-submit");
        tags.setConfig("server_address", "$portalPath/actions/anotar.ajax");
        tags.setConfig("server_mode", "fascinator");
        tags.setConfig("disable_replies", true);
        tags.init($);  
        
        // Location Tags annotaion
        var locationTags = new Anotar();
        locationTags.setType("Tag");
        locationTags.setConfig("debug", true);
        locationTags.setConfig("doc_root", "#location-tag-list");
        locationTags.setConfig("tag_list", "p");
        locationTags.setConfig("content_input", "#txtName");
        locationTags.setConfig("page_uri", "$self.object.id");
        locationTags.setConfig("uri_attr", "id");
        locationTags.setConfig("output_in_child", ".location-tags");
        locationTags.setConfig("style_prefix", "location-tags-");
        locationTags.setConfig("proxy_required", false);
        locationTags.setConfig("interface_label", " <img src='$portalPath/images/icons/add.png'/>");
        locationTags.setConfig("interface_visible", true);
        locationTags.setConfig("hash_type", "http://www.geonames.org/");
        locationTags.setConfig("hash_function", function(node) {
            var rel = node.attr("rel");
            if (rel == null) {
                //rel = "$oid";
                return "http://www.geonames.org/";
            }
            return "http://www.geonames.org/" + rel;
        });
        locationTags.setConfig("form_custom", "location_form");
        locationTags.setConfig("form_cancel", ".locTag-cancel");
        locationTags.setConfig("form_submit", ".locTag-submit");
        locationTags.setConfig("server_address", "$portalPath/actions/anotar.ajax");
        locationTags.setConfig("server_mode", "fascinator");
        locationTags.setConfig("disable_replies", true);
        locationTags.setConfig("display_custom", "location_tag_form");
        locationTags.init($);
        */
        
        #if($self.mimeType.startsWith("audio/") || $self.mimeType.startsWith("video/"))
        // Audio/Video Tags annotation
        var videoAnoLabel = "<img src='$portalPath/images/icons/comment_add.png'/>&#160;Comment on this media:";
        videoConfig={
            debug: true,
            label: videoAnoLabel,
            objectLiteral: "self.object.id",
            pageUri: "$self.object.id",
            docRoot: ".video-results-list",
            tagList: ".video-result-list",
            uriAttr: "anotar-id",
            replyLabel: "<img src='$portalPath/images/icons/comments_add.png'/>",
            //formPrepend: true,
            stylePrefix: "anno-",
            interfaceLabel: videoAnoLable,
            interfaceVisible: true,
            formCustom: "media_clip_form",
            formCancel: ".myTag-cancel",
            formSubmit: ".myTag-submit",
            displayCustom: "media_clip_comment", 
            hashType: "http://www.w3.org/TR/2009/WD-media-frags-20091217",
            hashFunction: function(node) {
                var rel = node.attr("rel");
                if (rel == null) { rel = "$oid"; }
                return rel;
            },
            serverAddress: "$portalPath/actions/anotar.ajax",
            disableReply: false,
            serverMode: "fascinator"
        }
        $("#media_clip textArea").live("focus", function() {
            var replies = $("#media_clip").prev("blockquote.anno-inline-annotation-quote")
                                          .find(".anno-anno-children");
            if (replies.length > 0) {
                $(".annotate_scope").hide();
            } else {
                $(".annotate_scope").show();
            }
            return false;
        });
        
        videoTag = anotarFactory(jQ, videoConfig);
        #else
        
        noteConfig={
            //objectLiteral: "$self.object.id",
            pageUri: "$self.object.id",
            #if($page.authentication.is_logged_in()) 
            creator: "$page.authentication.get_name()",
            creatorUri: null,
            #end
            tagList: "p, h1, h2, h3, h4, h5, h6, .annotatable",
            //uriAttr: "anotar-hash",
            interfaceLabel: " <img src='$portalPath/images/icons/comment_add.png'/> Comments:",
            replyLabel: " <img src='$portalPath/images/icons/comments_add.png'/>",
            serverAddress: "$portalPath/actions/anotar.ajax",
            serverMode: "fascinator",
            interfaceVisible: true
        }
        noteTag = anotarFactory(jQ, noteConfig);
        #end
        
        /*
        #if($self.mimeType.startsWith("audio/") || $self.mimeType.startsWith("video/"))
        // Video annotation
        var videoAnoLabel = "<img src='$portalPath/images/icons/comment_add.png'/>&#160;Comment on this media:";
        var videoAno = new Anotar();
        //videoAno.setConfig("debug", true);
        videoAno.setConfig("label", videoAnoLabel);
        videoAno.setConfig("object_literal", "$self.object.id"); 
        videoAno.setConfig("page_uri", "$portalPath/$self.object.id");
        videoAno.setConfig("doc_root", ".video-results-list");
        videoAno.setConfig("tag_list", ".video-result-list");
        videoAno.setConfig("uri_attr", "anotar-uri");
        videoAno.setConfig("reply_label", " <img src='$portalPath/images/icons/comments_add.png'/>");
        videoAno.setConfig("hash_type", "http://www.w3.org/TR/2009/WD-media-frags-20091217");
        videoAno.setConfig("hash_function", function(node) {
            var rel = node.attr("rel");
            if (rel == null) { rel = "$oid"; }
            return rel;
        });
        videoAno.setConfig("style_prefix", "anno-");
        videoAno.setConfig("proxy_required", false);
        videoAno.setConfig("interface_label", videoAnoLabel);
        videoAno.setConfig("interface_visible", true);
        videoAno.setConfig("form_custom", "media_clip_form");
        videoAno.setConfig("form_cancel", ".myTag-cancel");
        videoAno.setConfig("form_submit", ".myTag-submit");
        videoAno.setConfig("server_address", "$portalPath/actions/anotar.ajax");
        videoAno.setConfig("server_mode", "fascinator");
        videoAno.setConfig("disable_replies", false);
        videoAno.setConfig("display_custom", "media_clip_comment");
        videoAno.init($);
        
        $("#media_clip textArea").live("focus", function() {
            var replies = $("#media_clip").prev("blockquote.anno-inline-annotation-quote")
                                          .find(".anno-anno-children");
            if (replies.length > 0) {
                $(".annotate_scope").hide();
            } else {
                $(".annotate_scope").show();
            }
            return false;
        });
        #else
        // Comment annotation
        var notes = new Anotar();
        //notes.setConfig("debug", true);
        //notes.setConfig("object_literal", "$self.object.id");
        notes.setConfig("page_uri", "$portalPath/$self.object.id");
        #if($page.authentication.is_logged_in())
        notes.setConfig("creator", "$page.authentication.get_name()");
        notes.setConfig("creator_uri", null);
        #end
        notes.setConfig("tag_list", "p, h1, h2, h3, h4, h5, h6, .annotatable");
        notes.setConfig("proxy_required", false);
        notes.setConfig("interface_label", " <img src='$portalPath/images/icons/comment_add.png'/> Comments:");
        notes.setConfig("reply_label", " <img src='$portalPath/images/icons/comments_add.png'/>");
        notes.setConfig("server_address", "$portalPath/actions/anotar.ajax");
        notes.setConfig("server_mode", "fascinator");
        notes.setConfig("interface_visible", true);
        notes.init($);
        #end
        */
    });
    
</script>

<script type="text/javascript">
    function attach(node) {
        if (!$(node).attr("attach")) {
            $(node).attr("attach", "true");
            $(node).autocomplete('$portalPath/actions/geonames.ajax', {
                extraParams: {"func":"placeName"}, 
                formatItem: function(row) {
                    return row[0];
                }
            }).result(function(event, item) {
                if (item) {
                    $("#location-tag-list").attr("rel", item[1]);
                }
            });
        }
    }
</script>

<script type="text/html" id="location_form">
  <div id="location_div">
    <table>
      <tr>
        <td colspan="2" class="location_scope">
          <input type="radio" name="location_scope" id="byName" checked="true"
                 onclick="$('.annotate_name').show();$('.annotate_ll').hide();$('.annotate_range').hide();" />
          <label for="byName">By Location Name</label>
          <input type="radio" name="location_scope" id="byLL"
                 onclick="$('.annotate_name').hide();$('.annotate_ll').show();$('.annotate_range').hide();" />
          <label for="byLL">By Latitude/Longitude</label>
          <input type="radio" name="location_scope" id="byRange"
                 onclick="$('.annotate_name').hide();$('.annotate_ll').hide();$('.annotate_range').show();" />
          <label for="byRange">By Range</label>
        </td>
      </tr>
      <tr class="annotate_name">
        <td>Search: <input type="text" id="txtName" size="45"/></td>
      </tr>
      <tr class="hidden annotate_ll">
        <td>Latitude: <input type="text" id="txtLatitude"/>
        Longitude: <input type="text" id="txtLongitude"/></td>
      </tr>
      <tr class="hidden annotate_range">
        <td>Range: Range</td>
      </tr>
      <tr>
        <td><button class="locTag-cancel">Cancel</button>&#160;
            <button class="locTag-submit">Submit</button></td>
      </tr>
    </table>
  </div>
</script>

<script type="text/html" id="location_tag_form">
    <% if (contentUri != null && contentUri.indexOf("http://www.geonames.org") == 0) { %>
  <span class='<%=style%>tag'>
      <a href="<%=contentUri%>"><%=content%><% if(tagCount > 1){ %> (<%=tagCount%>)<% } %></a>
  </span>
    <% } else { %>
      <span></span>
      ##<a href="http://www.geonames.org/search.html?q=<%=content%>"><%=content%></a>
    <% }%>
</script>


#if($self.mimeType.startsWith("audio/") || $self.mimeType.startsWith("video/"))
<script type="text/html" id="media_clip_form">
  <div id="media_clip">
    <table>
      <tr>
        <td colspan="2" class="annotate_scope">
          <input type="radio" name="annotate_scope" id="annotate_all" checked="true"
                 onclick="$('.annotate_clip').hide()" />
          <label for="annotate_all">Comment on the whole video</label><br/>
          <input type="radio" name="annotate_scope" id="annotate_clip"
                 onclick="$('.annotate_clip').show()" />
          <label for="annotate_clip">Select a portion (clip) to annotate</label>
          <span class="hidden annotate_clip">(<a onclick="toggleHelp($(this))">Show help</a>)</span>
        </td>
      </tr>
      <tr class="hidden annotate_clip">
        <td colspan="2">
          <p class="help_p">The tools below will help you select a specific
          section of video that you want to comment on. We call this section a
          "clip". This top row of buttons is similar to those on your home DVD
          player:</p>
          <ul class="help_p">
          <li>To go to the beginning of the video, click the "&lt;&lt; button</li>
          <li>To move the video forward by 1 second click on the "&lt;" button</li>
          <li>To play and pause the video click on the "Play/Pause" button</li>
          <li>To move the video back by 1 second click on the "&gt;" button</li>
          <li>To go to the end of the video, click the "&gt;&gt; button</li>
          </ul>
        </td>
      </tr>
      <tr class="hidden annotate_clip">
        <td colspan="2">
          <input id="player_seek_start" type="button" value="&lt;&lt;" />
          <input id="player_rewind" type="button" value="&lt;" />
          <input id="player_play" type="button" value="Play/Pause" />
          <input id="player_forward" type="button" value="&gt;" />
          <input id="player_seek_end" type="button" value="&gt;&gt;" />
        </td>
      </tr>
      <tr class="hidden annotate_clip">
        <td colspan="2">
          <p class="help_p">To create a clip, you need to set a beginning and
          end time. We use seconds to set the time.
          <br/>
          You can start the video playing and press the "Mark start time" and
          "Mark end time" buttons and the system will set the timing for you.
          <br/>
          Alternatively, you can enter the start and end times as seconds in
          the corresponding text boxes.
          </p>
        </td>
      </tr>
      <tr class="hidden annotate_clip">
        <td><input id="player_mark_start_time" type="button" value="Mark start time" value=""/></td>
        <td><input type="text" id="txtStartMark" value="" size="5"/></td>
      </tr>
      <tr class="hidden annotate_clip">
        <td><input id="player_mark_end_time" type="button" value="Mark end time" value="" disabled="true"/></td>
        <td><input type="text" id="txtEndMark" value="" disabled="true" size="5"/></td>
      </tr>
      <tr class="hidden annotate_clip">
        <td colspan="2">
          <p class="help_p">Once you have set the start and end times for your
          clip you can preview the clip by pressing "Play clip".
          <br/>You can also scrap the clip by pressing "Clear clip".</p>
        </td>
      </tr>
      <tr class="hidden annotate_clip">
        <td colspan="2">
          <input class="player_clear_fragment" type="button" value="Clear clip" />
          <input id="player_play_fragment" type="button" value="Play clip" />
        </td>
      </tr>
      <tr><td colspan="2">Comment:</td></tr>
      <tr><td colspan="2"><textArea cols="30"></textArea></td></tr>
      <tr><td colspan="2">
        <button class="myTag-cancel">Cancel</button>&#160;
        <button class="myTag-submit">Submit</button>
      </tr>
    </table>
  </div>
</script>
<script type="text/html" id="media_clip_comment">
  <%
  var startTime = "";
  var endTime = "";
  if (locator != null) {
    var npt = locator.split("#t=npt:");
    if (npt.length > 1) {
        npt = npt[1].split(",");
        startTime = npt[0];
        if (startTime.length == 0) { startTime = "0s"; }
        endTime = npt[1];
        if (endTime.length == 0) { endTime = "0s"; }
    }
  }
  %>
  <div class="<%=style%>inline-annotation <%=toggle%>" id="<%=id%>">
      <input name="rootUri" value="<%=root%>" type="hidden"/>
      <div class="<%=style%>orig-content" style="display:none;"><%=original%></div>
      <div class="<%=style%>anno-info">
        Comment by: <span class="<%=style%>anno-creator"><%=creator%></span>
         &nbsp; <span class="<%=style%>anno-date"><%=date%></span>
      </div>
      <% if (startTime != "" && endTime != "") { %>
      <div class="<%=style%>anno-info">
        <input class="player_play_clip" type="button" value="Play" />
        Clip duration: <span class="startTime"><%=startTime%></span> to
        <span class="endTime"><%=endTime%></span>
      </div>
      <% } %>
      <div>
        <span class="<%=style%>anno-content"><%=content%></span>
      </div>
      <div class="<%=style%>anno-children"><%=children%></div>
  </div>
</script>
#end
#end
