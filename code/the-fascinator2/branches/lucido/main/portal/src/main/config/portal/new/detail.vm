#set($pageTitle = 'Detail')
#if($self.solrResponse.get("response/numFound") == 0)
<h2 id="page-heading">Page not found</h2>
<p>Please try a different <a href="$portalPath/search">search</a>.</p>
#else
#set($pageHeader = '<script type="text/javascript" src="' + $portalPath + '/flowplayer/flowplayer-3.1.2.min.js"></script>')
#set($meta = $self.metadata)
#set($oid = $self.object.id)
#set($title = $meta.getField("dc_title"))
#set($description = $meta.getField("dc_description"))
<script type="text/javascript">
$(function() {
    $("#blog-this").click(function() {
        $(this).toggleClass("selected");
        $("#blog-form").toggle("blind");
        return false;
    });
    $("#blog-button").click(function() {
        jQuery.post("$portalPath/blog.ajax",
            {
                url: $("#blog_url").val(),
                title: $("#blog_title").val(),
                username: $("#blog_username").val(),
                password: $("#blog_password").val(),
                oid: "$oid",
            }, function(data, status) {
            $("#blog-message").html(data);
        });
    });
    $("#attachments h2 a").click(function() {
        $("#attachments ul").toggle("blind");
        return false;
    });
});
</script>
#if(!$title)
  #set($title = $self.getFileName($oid))
#end
<h2 id="page-heading">$title</h2>
<div class="grid_4">
  <div class="box menu">
    <h2><a href="#">Actions</a></h2>
    <ul class="menu" id="actions">
      <li><a id="open-this" href="$portalPath/detail/$oid">Open file</a></li>
      #if($self.hasHtml())
      <li><a id="blog-this" href="#">Blog to WordPress...</a><li>
      #end
    </ul>
  </div>
  <div class="box">
    <h2><a href="#">Metadata</a></h2>
    #set($dc = $meta.dublinCore)
    <div class="block">
      <table>
        <tbody>
        #foreach($key in $dc.keySet())
          #set($name = $self.formatName($key))
          #set($value = $self.formatValue($dc.get($key)))
          <tr>
            <th>$name</th>
            <td>$value</td>
          </tr>
        #end
        </tbody>
      </table>
    </div>
  </div>
  <div id="attachments" class="box menu">
    <h2><a href="#">Attachments</a></h2>
    <ul class="menu hidden">
    #foreach($payload in $self.object.payloadList)
      #set($pid = $payload.id)
      #set($payloadType = $payload.type.toString())
      <li>
        <a href='$portalPath/download/$oid/$pid' rel="$payloadType" target="blank" title="$payload.contentType">$payload.id</a>
      </li>
    #end
    </ul>
  </div>
</div>
<div class="grid_12">
  <div class="box hidden" id="blog-form">
  <form id="blog" method="post">
    <fieldset class="login">
      <legend>Blog to WordPress</legend>
      <p>
        <label for="blog_url">Blog URL</label>
        <input type="text" id="blog_url" name="blog_url" />
      </p>
      <p>
        <label for="blog_title">Title</label>
        <input type="text" id="blog_title" name="blog_title" value="$title"/>
      </p>
      <p>
        <label for="blog_username">Username</label>
        <input type="text" id="blog_username" name="blog_username" />
      </p>
      <p>
        <label for="blog_password">Password</label>
        <input type="password" id="blog_password" name="blog_password" />
      </p>
      <p id="blog-message"></p>
      <input class="button" id="blog-button" type="button" value="Blog" />
    </fieldset>
  </form>
  </div>
  <div class="box articles">
    <h2>Preview</h2>
    <div class="content-preview block">
      <div class="first article clearfix">
        <div class="content-preview-inline">$!self.payloadContent</div>
      </div>
    </div>
  </div>
</div>
<div class="clear"></div>
<div class="ui-helper-hidden" id="record-meta">
  <label id="oid">$oid</label>
  <label id="format">$self.mimeType</label>
  <label id="hasSlide">$self.hasSlideShow()</label>
</div>
<script type="text/javascript">
$(function() {
    var oid = $("#oid").text();
    $("#hasSlide").each(function() {
        var hasSlide = $(this).text();
        if (hasSlide != "") {
            $('div.view-as-slideshow').append("<form action='$portalPath/download/" + oid + "/" + hasSlide + "' target='_blank'>" +
            "<input type='submit' value='View as Slideshow'>" +  
            "</form>");
        }
    });
    
    $("div.content-preview-inline span.slide-link").each(function() {
        $(this).empty();
        $("#actions").append("<li><a href='$portalPath/download/$oid/$self.hasSlideShow()' target='_blank'>View slideshow</a></li>");
    });
    
    $("div.content-preview-inline span.pdf-rendition-link").each(function() {
        $(this).empty();
        $("#actions").append("<li><a href='$portalPath/download/$self.pdfUrl'>Printable version (PDF)</a></li>");
    });
    
    $("#hasSlide").each(function() {
        var hasSlide = $(this).text();
        if (hasSlide != "") {
            $('div.view-as-slideshow').append("<form action='download/" + oid + "/" + hasSlide + "' target='_blank'>" +
            "<input type='submit' value='View as Slideshow'>" +  
            "</form>");
        } 
    });
    
    $("#format").each(function() {
        var mimeType = $(this).text().toLowerCase();
        if (mimeType.indexOf("image") == 0) {
            var imgsrc = "$portalPath/download/" + oid;
            $('div.content-preview .article').html("<a class='image' href='" + imgsrc + "'><img src='" + imgsrc + "'/></a>");
        } else if (mimeType.indexOf("audio") == 0 || mimeType.indexOf("video") == 0) {
            var filename = '$portalPath/download/' + oid + "/" + oid.substring(oid.lastIndexOf("/")+1).replace("wmv", "flv");
            var height = 300;
            if (mimeType.indexOf("audio") == 0) {
                height = 24;
            }
            $('div.content-preview-inline').append('<a href="' + filename + '" id="player" style="display:block;width:425px;height:' + height + 'px;"></a>');
            flowplayer("player", "$portalPath/flowplayer/flowplayer-3.1.2.swf");
        }
    });
    
    $("#open-this").click(function() {
        jQuery.post("$portalPath/detail/" + oid, { verb: "open", value: oid } );
    });
    
    $("div.content-preview-inline img").each(function() {
        var src = $(this).attr("src");
        var srcVal = src.toLowerCase();
        if (srcVal.indexOf("http://") == -1 && srcVal.indexOf("file://") == -1) {
            $(this).attr("src", "$portalPath/download/" + oid + "/" + src);
        }
    });
});
</script>
#end

